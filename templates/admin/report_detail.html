<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Awaaz | Admin - Report Detail</title>
	<link rel="stylesheet" href="/static/css/dark.css" />
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#000000] text-[#f5f5f7]">
	<div class="container max-w-5xl mx-auto px-4 py-8">
		<header class="flex items-center justify-between py-6">
			<h1 class="text-2xl font-semibold text-red-500">⚠️ Report Detail</h1>
			<div class="space-x-3 text-sm">
				<a class="text-blue-400 hover:text-blue-300" href="{% url 'admin_reports' %}">← Back to Reports</a>
				<span class="text-zinc-400">|</span>
				<a class="text-blue-400 hover:text-blue-300" href="{% url 'admin_dashboard' %}">Dashboard</a>
			</div>
		</header>

		{% if messages %}
			{% for message in messages %}
				<div class="mb-4 p-4 rounded-md {% if message.tags == 'error' %}bg-red-900 text-red-200{% else %}bg-green-900 text-green-200{% endif %}">
					{{ message }}
				</div>
			{% endfor %}
		{% endif %}

		<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
			<!-- Report Information -->
			<div class="card p-6 space-y-4">
				<h2 class="text-xl font-semibold border-b border-[#2a2a36] pb-3">Report Information</h2>
				
				<div>
					<label class="text-sm text-zinc-400">Status</label>
					<p class="mt-1">
						<span class="px-3 py-1 rounded text-sm font-medium
							{% if report.status == 'pending' %}bg-yellow-900 text-yellow-200
							{% elif report.status == 'verified' %}bg-red-900 text-red-200
							{% else %}bg-green-900 text-green-200{% endif %}">
							{{ report.get_status_display }}
						</span>
					</p>
				</div>
				
				<div>
					<label class="text-sm text-zinc-400">Reason</label>
					<p class="mt-1 font-medium">{{ report.get_reason_display }}</p>
				</div>
				
				<div>
					<label class="text-sm text-zinc-400">Reporter</label>
					<p class="mt-1">{{ report.reporter.username }}</p>
				</div>
				
				<div>
					<label class="text-sm text-zinc-400">Reported On</label>
					<p class="mt-1 text-sm">{{ report.created_at|date:"F d, Y H:i" }}</p>
				</div>
				
				{% if report.reviewed_by %}
					<div>
						<label class="text-sm text-zinc-400">Reviewed By</label>
						<p class="mt-1 text-sm">{{ report.reviewed_by.username }}</p>
					</div>
					<div>
						<label class="text-sm text-zinc-400">Reviewed On</label>
						<p class="mt-1 text-sm">{{ report.reviewed_at|date:"F d, Y H:i" }}</p>
					</div>
				{% endif %}
				
				{% if report.description %}
					<div>
						<label class="text-sm text-zinc-400">Description</label>
						<p class="mt-1 text-sm text-zinc-300">{{ report.description }}</p>
					</div>
				{% endif %}
			</div>

			<!-- Complaint Information -->
			<div class="card p-6 space-y-4">
				<h2 class="text-xl font-semibold border-b border-[#2a2a36] pb-3">Complaint Details</h2>
				
				<div>
					<label class="text-sm text-zinc-400">Title</label>
					<p class="mt-1 font-medium">{{ complaint.title }}</p>
				</div>
				
				<div>
					<label class="text-sm text-zinc-400">Posted By</label>
					<p class="mt-1">{{ complaint.user.username }}</p>
				</div>
				
				<div>
					<label class="text-sm text-zinc-400">Severity</label>
					<p class="mt-1">
						<span class="px-2 py-1 rounded text-xs bg-blue-900 text-blue-200">
							{{ complaint.get_predicted_severity_display }}
						</span>
					</p>
				</div>
				
				<div>
					<label class="text-sm text-zinc-400">Location</label>
					<p class="mt-1 text-sm">{{ complaint.location|default:"Not specified" }}</p>
				</div>
				
				<div>
					<label class="text-sm text-zinc-400">Posted On</label>
					<p class="mt-1 text-sm">{{ complaint.created_at|date:"F d, Y H:i" }}</p>
				</div>
				
				<div>
					<a href="{% url 'complaint_detail' complaint.pk %}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm">View Full Complaint →</a>
				</div>
			</div>
		</div>

		<!-- User Profile Info -->
		<div class="card p-6 mt-6">
			<h2 class="text-xl font-semibold border-b border-[#2a2a36] pb-3 mb-4">User Profile</h2>
			<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
				<div>
					<label class="text-sm text-zinc-400">Username</label>
					<p class="mt-1 font-medium">{{ complaint.user.username }}</p>
				</div>
				<div>
					<label class="text-sm text-zinc-400">Warnings</label>
					<p class="mt-1 text-xl font-bold {% if user_profile.warnings > 0 %}text-yellow-400{% else %}text-green-400{% endif %}">
						{{ user_profile.warnings }}
					</p>
				</div>
				<div>
					<label class="text-sm text-zinc-400">Account Status</label>
					<p class="mt-1">
						{% if user_profile.is_currently_banned %}
							<span class="px-3 py-1 rounded text-sm font-medium bg-red-900 text-red-200">
								BANNED
								{% if user_profile.banned_until %}
									(Until {{ user_profile.banned_until|date:"M d, Y" }})
								{% else %}
									(Permanent)
								{% endif %}
							</span>
						{% else %}
							<span class="px-3 py-1 rounded text-sm font-medium bg-green-900 text-green-200">Active</span>
						{% endif %}
					</p>
				</div>
			</div>
			{% if user_profile.ban_reason %}
				<div class="mt-4">
					<label class="text-sm text-zinc-400">Ban Reason</label>
					<p class="mt-1 text-sm text-zinc-300">{{ user_profile.ban_reason }}</p>
				</div>
			{% endif %}
		</div>

		<!-- Actions -->
		<div class="card p-6 mt-6">
			<h2 class="text-xl font-semibold border-b border-[#2a2a36] pb-3 mb-4">Actions</h2>
			
			{% if report.status == 'pending' %}
				<div class="space-y-4">
					<!-- Verify Report -->
					<form method="post" class="border border-yellow-700 rounded-md p-4 bg-yellow-900/20">
						{% csrf_token %}
						<input type="hidden" name="action" value="verify">
						<p class="text-sm text-yellow-200 mb-3">
							<strong>Verify Report:</strong> This will mark the report as verified and automatically warn the user.
						</p>
						<button type="submit" class="rounded-md bg-yellow-600 hover:bg-yellow-500 px-4 py-2 font-medium">
							Verify Report & Warn User
						</button>
					</form>

					<!-- Dismiss Report -->
					<form method="post" class="border border-green-700 rounded-md p-4 bg-green-900/20">
						{% csrf_token %}
						<input type="hidden" name="action" value="dismiss">
						<p class="text-sm text-green-200 mb-3">
							<strong>Dismiss Report:</strong> This will mark the report as dismissed if it's not valid.
						</p>
						<button type="submit" class="rounded-md bg-green-600 hover:bg-green-500 px-4 py-2 font-medium">
							Dismiss Report
						</button>
					</form>
				</div>
			{% endif %}

			<div class="mt-6 space-y-4">
				<!-- Delete Complaint -->
				<form method="post" onsubmit="return confirm('Are you sure you want to delete this complaint?');" class="border border-red-700 rounded-md p-4 bg-red-900/20">
					{% csrf_token %}
					<input type="hidden" name="action" value="delete_complaint">
					<p class="text-sm text-red-200 mb-3">
						<strong>Delete Complaint:</strong> This will permanently delete the reported complaint.
					</p>
					<button type="submit" class="rounded-md bg-red-600 hover:bg-red-500 px-4 py-2 font-medium">
						Delete Complaint
					</button>
				</form>

				<!-- Warn User -->
				<form method="post" class="border border-yellow-700 rounded-md p-4 bg-yellow-900/20">
					{% csrf_token %}
					<input type="hidden" name="action" value="warn_user">
					<p class="text-sm text-yellow-200 mb-3">
						<strong>Warn User:</strong> Add a warning to the user's account.
					</p>
					<button type="submit" class="rounded-md bg-yellow-600 hover:bg-yellow-500 px-4 py-2 font-medium">
						Warn User
					</button>
				</form>

				<!-- Ban User (Temporary) -->
				<form method="post" class="border border-red-700 rounded-md p-4 bg-red-900/20">
					{% csrf_token %}
					<input type="hidden" name="action" value="ban_user">
					<p class="text-sm text-red-200 mb-3">
						<strong>Temporary Ban:</strong> Ban the user for a specified number of days.
					</p>
					<div class="flex gap-3 items-end">
						<div class="flex-1">
							<label class="block text-sm text-zinc-400 mb-1">Ban Duration (days)</label>
							<input type="number" name="ban_duration" value="7" min="1" class="w-full rounded-md bg-[#0f0f14] border border-[#2a2a36] p-2">
						</div>
						<div class="flex-1">
							<label class="block text-sm text-zinc-400 mb-1">Reason</label>
							<input type="text" name="ban_reason" value="Reported complaint: {{ complaint.title }}" class="w-full rounded-md bg-[#0f0f14] border border-[#2a2a36] p-2">
						</div>
						<button type="submit" class="rounded-md bg-red-600 hover:bg-red-500 px-4 py-2 font-medium">
							Ban User
						</button>
					</div>
				</form>

				<!-- Permanent Ban -->
				<form method="post" onsubmit="return confirm('Are you sure you want to permanently ban this user?');" class="border border-red-800 rounded-md p-4 bg-red-950/20">
					{% csrf_token %}
					<input type="hidden" name="action" value="permanent_ban">
					<p class="text-sm text-red-300 mb-3">
						<strong>Permanent Ban:</strong> Permanently ban the user from the platform.
					</p>
					<div class="flex gap-3 items-end">
						<div class="flex-1">
							<label class="block text-sm text-zinc-400 mb-1">Reason</label>
							<input type="text" name="ban_reason" value="Reported complaint: {{ complaint.title }}" class="w-full rounded-md bg-[#0f0f14] border border-[#2a2a36] p-2">
						</div>
						<button type="submit" class="rounded-md bg-red-700 hover:bg-red-600 px-4 py-2 font-medium">
							Permanently Ban User
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</body>
</html>

