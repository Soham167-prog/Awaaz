<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Awaaz | Complaint Detail</title>
	<link rel="stylesheet" href="/static/css/dark.css" />
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#000000] text-[#f5f5f7] min-h-screen">
	<div class="container max-w-5xl mx-auto px-4 py-10">
		<header class="flex items-center justify-between mb-6">
			<h1 class="text-2xl font-semibold text-green-300">Complaint #{{ complaint.pk }}</h1>
			<div class="space-x-3 text-sm">
				<a class="text-blue-400 hover:text-blue-300" href="{% url 'government_dashboard' %}">‚Üê Back to Dashboard</a>
				<span class="text-zinc-500">|</span>
				<a class="text-red-400 hover:text-red-300" href="{% url 'logout' %}">Logout</a>
			</div>
		</header>
		{% include 'components/flash_messages.html' %}

		<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
			<div class="lg:col-span-2 card p-6 space-y-4">
				<div class="flex items-center justify-between">
					<h2 class="text-xl font-semibold">{{ complaint.title }}</h2>
					<span class="badge {{ complaint.predicted_severity }}">{{ complaint.predicted_severity|capfirst }}</span>
				</div>
				<p class="text-sm text-zinc-400">Reported {{ complaint.created_at|date:"F d, Y H:i" }} by {{ complaint.user.username }}</p>
				{% if complaint.location %}
				<p class="text-sm text-zinc-300">Location: {{ complaint.location }}</p>
				{% endif %}
				<p class="text-sm text-zinc-200 whitespace-pre-line">{{ complaint.description }}</p>
				{% if complaint.image %}
				<div>
					<img src="{{ complaint.image.url }}" alt="Complaint image" class="rounded-md">
				</div>
				{% endif %}
			</div>
			<div class="card p-6 space-y-4">
				<h3 class="font-semibold text-lg">Actions</h3>
				{% if not complaint.is_resolved %}
					<a href="{% url 'complaint_resolve' complaint.pk %}" class="block rounded-md bg-green-600 hover:bg-green-500 text-center py-2 font-medium">Mark as Resolved</a>
				{% else %}
					<div class="p-4 bg-green-900/20 border border-green-700 rounded-md text-green-200 text-sm">
						Resolved {{ complaint.resolved_at|date:"F d, Y H:i" }} by {{ complaint.resolved_by.username if complaint.resolved_by else 'Unknown' }}
					</div>
				{% endif %}
				<a href="{% url 'complaint_detail' complaint.pk %}" class="block rounded-md border border-blue-500 hover:bg-blue-500 hover:text-black text-center py-2 text-blue-300">View as Citizen</a>
			</div>
		</div>

		<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
			<div class="lg:col-span-2 card p-6">
				<h3 class="font-semibold text-lg mb-4">Official Updates</h3>
				<div class="space-y-4">
					{% for c in official_comments %}
					<div class="border border-green-800/40 rounded-md p-4 bg-green-900/20">
						<p class="text-sm font-semibold text-green-200 flex items-center gap-2">
							{{ c.user.username }}
							{% if c.is_resolution_comment %}
								<span class="px-2 py-1 bg-green-700 text-green-100 text-xs rounded">RESOLUTION</span>
							{% else %}
								<span class="px-2 py-1 bg-green-800 text-green-200 text-xs rounded">OFFICIAL</span>
							{% endif %}
						</p>
						<p class="text-xs text-green-300 mt-1">{{ c.created_at|date:"M d, Y H:i" }}</p>
						<p class="text-sm text-green-100 mt-2">{{ c.text }}</p>
					</div>
					{% empty %}
					<p class="text-sm text-zinc-400">No official comments yet.</p>
					{% endfor %}
				</div>
			</div>
			<div class="card p-6">
				<h3 class="font-semibold text-lg mb-4">Add Official Comment</h3>
				<form method="post">
					{% csrf_token %}
					<input type="hidden" name="action" value="comment" />
					{{ comment_form.text }}
					{% if comment_form.text.errors %}
						<p class="text-xs text-red-300 mt-1">{{ comment_form.text.errors.0 }}</p>
					{% endif %}
					<button type="submit" class="mt-3 w-full rounded-md bg-green-600 hover:bg-green-500 py-2 font-medium">Post Update</button>
				</form>
			</div>
		</div>
	</div>
</body>
</html>
